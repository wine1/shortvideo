"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
let touchDotX = 0;
let touchDotY = 0;
Component({
    properties: {
        duration: {
            type: Number,
            value: 500
        },
        easingFunction: {
            type: String,
            value: 'default'
        },
        loop: {
            type: Boolean,
            value: true
        },
        pauseCurrentVideo: {
            type: Boolean,
            value: false,
            observer: function observer() {
                let current = this.data._last;
                let { curQueue } = this.data;
                let that = this;
                if (arguments[0]) {
                    curQueue.forEach(function (item) {
                        item.isPlay = false;
                    });
                }
                else {
                    this.data._videoContexts.forEach(function (index) {
                        if (current === index) {
                            that.data._videoContext.play();
                        }
                        else {
                            setTimeout(() => {
                                that.data._videoContext.pause();
                            }, 100);
                        }
                    });
                    curQueue.forEach(function (item, index) {
                        item.isPlay = current === index ? true : false;
                    });
                }
                this.setData({
                    curQueue
                });
            }
        },
        videoList: {
            type: Array,
            value: [],
            observer: function observer() {
                var newVal = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
                newVal && this._videoListChanged(newVal);
            }
        },
    },
    data: {
        nextQueue: [],
        prevQueue: [],
        curQueue: [],
        circular: false,
        _last: 0,
        _change: -2,
        _invalidUp: 0,
        _invalidDown: 0,
        _videoContexts: [],
        diff: 0,
        showCommentList: false,
        hotReplyLists: [],
        newReplyLists: [],
        touchDirction: 0,
        lastTime: 0,
        lastTimeoutFunc: [],
        hasLogin: false,
        showLoginPop: false,
        time_id: 600,
        like_imgs: [],
    },
    lifetimes: {
        attached() {
        }
    },
    methods: {
        touchStart: function (e) {
            touchDotX = e.touches[0].pageX;
            touchDotY = e.touches[0].pageY;
        },
        touchEnd: function (e) {
            let { curQueue } = this.data;
            let touchMoveX = e.changedTouches[0].pageX;
            let touchMoveY = e.changedTouches[0].pageY;
            let tmX = touchMoveX - touchDotX;
            let tmY = touchMoveY - touchDotY;
            let absX = Math.abs(tmX);
            let absY = Math.abs(tmY);
            if (absY > absX * 2 && tmY < 10) {
                console.log("上滑动=====", this.data.diff, this.data.nextQueue);
                curQueue.forEach((item, index) => {
                    if (this.data._last === index) {
                        item.isSeek = true;
                    }
                    else {
                        item.isSeek = false;
                    }
                });
                this.setData({
                    touchDirction: 1,
                    curQueue
                });
            }
            else if (absY > absX * 2 && tmY > 100) {
                console.log("下滑动=====", this.data.diff, this.data.prevQueue);
                curQueue.forEach((item, index) => {
                    if (this.data._last === index) {
                        item.isSeek = true;
                    }
                    else {
                        item.isSeek = false;
                    }
                });
                this.setData({
                    touchDirction: 2,
                    curQueue
                });
                if (!this.data.prevQueue.length && this.data._last == 0) {
                    this.setData({
                        prevQueue: [],
                        nextQueue: []
                    });
                    this.triggerEvent('funcPulldownRefresh');
                }
            }
        },
        _videoListChanged: function _videoListChanged(newVal) {
            var _this = this;
            var data = this.data;
            data.nextQueue = newVal;
            if (data.curQueue.length === 0) {
                data.curQueue.forEach((item) => {
                    item.isPlay = false;
                    item.isCurrent = false;
                });
                this.setData({
                    curQueue: data.nextQueue.splice(0, 3)
                }, function () {
                    _this.playCurrent(0);
                    _this.triggerEvent('change', { activeVideo: data.curQueue[0] });
                });
            }
        },
        animationfinish: function animationfinish(e) {
            let that = this;
            let { _last, _change, curQueue, prevQueue, nextQueue, touchDirction } = this.data;
            var current = e.detail.current;
            var diff = current - _last;
            if (diff === 0) {
                this.setData({
                    diff: 0
                });
                return;
            }
            this.data._last = current;
            this.playCurrent(current);
            this.triggerEvent('change', { activeVideo: curQueue[current] });
            var direction = diff === 1 || diff === -2 ? 'up' : 'down';
            if (nextQueue.length === 2 && touchDirction == 1) {
                this.triggerEvent('funcPagination');
            }
            if (direction === 'up') {
                if (this.data._invalidDown === 0) {
                    var change = (_change + 1) % 3;
                    if (change < 0) {
                        this.setData({
                            _change: change
                        });
                        return;
                    }
                    var add = nextQueue.shift();
                    var remove = curQueue[change];
                    if (add) {
                        prevQueue.push(remove);
                        curQueue[change] = add;
                        this.data._change = change;
                    }
                    else {
                        this.data._invalidUp += 1;
                    }
                }
                else {
                    this.data._invalidDown -= 1;
                }
            }
            if (direction === 'down') {
                if (this.data._invalidUp === 0) {
                    var _change2 = _change;
                    var _remove = curQueue[_change2];
                    var _add = prevQueue.pop();
                    if (_add) {
                        curQueue[_change2] = _add;
                        nextQueue.unshift(_remove);
                        this.data._change = (_change - 1 + 3) % 3;
                    }
                    else {
                        this.data._invalidDown += 1;
                    }
                }
                else {
                    this.data._invalidUp -= 1;
                }
            }
            var circular = true;
            if (nextQueue.length === 0 && current !== 0) {
                circular = false;
            }
            if (prevQueue.length === 0 && current !== 2) {
                circular = false;
            }
            console.log(prevQueue, curQueue, nextQueue);
            this.setData({
                curQueue,
                prevQueue,
                nextQueue,
                circular,
            }, function () {
                that.playCurrent(current);
                that.triggerEvent('change', { activeVideo: that.data.curQueue[current] });
            });
        },
        playCurrent: function playCurrent(current) {
            let { curQueue } = this.data;
            curQueue.forEach((item, index) => {
                item.isPlay = index === current ? true : false;
                item.isCurrent = current === index ? true : false;
            });
            this.setData({
                curQueue
            });
        },
        gesture(e) {
            let currentTime = new Date().getTime();
            let { lastTime, lastTimeoutFunc, curQueue } = this.data;
            let current = e.currentTarget.dataset.index;
            let isPlay = e.currentTarget.dataset.isplay;
            if (currentTime - lastTime < 300) {
                clearTimeout(lastTimeoutFunc);
                this.drawLikeheart();
            }
            else {
                lastTimeoutFunc = setTimeout(() => {
                    curQueue.forEach((item, index) => {
                        if (current === index) {
                            item.isPlay = isPlay ? false : true;
                        }
                    });
                    this.setData({
                        curQueue
                    });
                }, 500);
            }
            this.setData({
                lastTime: currentTime,
                lastTimeoutFunc
            });
        },
        onPlay(e) {
            this.trigger(e, 'play');
        },
        onPause(e) {
            this.trigger(e, 'pause');
        },
        onEnded(e) {
            this.trigger(e, 'ended');
        },
        onError(e) {
            this.trigger(e, 'error');
        },
        onTimeUpdate(e) {
            this.trigger(e, 'timeupdate');
        },
        onWaiting(e) {
            this.trigger(e, 'wait');
        },
        onProgress(e) {
            this.trigger(e, 'progress');
        },
        onLoadedMetaData(e) {
            this.trigger(e, 'loadedmetadata');
        },
        trigger(e, type, ext = {}) {
            const detail = e.detail;
            const activeId = e.target.dataset.id;
            this.triggerEvent(type, Object.assign(Object.assign(Object.assign({}, detail), { activeId }), ext));
        },
        drawLikeheart() {
            var _this = this;
            if (_this.data.time_id) {
                clearTimeout(_this.data.time_id);
                var obj = {};
                obj.pageX = touchDotX - 40;
                obj.pageY = touchDotY - 40;
                var angle = Math.floor(Math.random() * 4);
                var animations = ['like-img-animate', 'like-img-animate-l', 'like-img-animate-r', 'like-img-animate-rr'];
                obj.animate = animations[angle];
                var like_imgs = _this.data.like_imgs.concat(obj);
                _this.setData({
                    like_imgs
                });
            }
            var time_id = setTimeout(function () {
                _this.setData({
                    like_imgs: [],
                });
            }, 600);
            _this.setData({
                time_id
            });
        },
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlkZW9Td2lwZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ2aWRlb1N3aXBlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQztBQUNsQixJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUM7QUFDbEIsU0FBUyxDQUFDO0lBQ1IsVUFBVSxFQUFFO1FBQ1YsUUFBUSxFQUFFO1lBQ1IsSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsR0FBRztTQUNYO1FBQ0QsY0FBYyxFQUFFO1lBQ2QsSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsU0FBUztTQUNqQjtRQUNELElBQUksRUFBRTtZQUNKLElBQUksRUFBRSxPQUFPO1lBQ2IsS0FBSyxFQUFFLElBQUk7U0FDWjtRQUNELGlCQUFpQixFQUFFO1lBQ2pCLElBQUksRUFBRSxPQUFPO1lBQ2IsS0FBSyxFQUFFLEtBQUs7WUFDWixRQUFRLEVBQUUsU0FBUyxRQUFRO2dCQUN6QixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQTtnQkFDN0IsSUFBSSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7Z0JBQzVCLElBQUksSUFBSSxHQUFRLElBQUksQ0FBQTtnQkFDcEIsSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUU7b0JBQ2hCLFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBVSxJQUFTO3dCQUNsQyxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQTtvQkFDckIsQ0FBQyxDQUFDLENBQUM7aUJBQ0o7cUJBQU07b0JBQ0wsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLFVBQVcsS0FBVTt3QkFDcEQsSUFBSSxPQUFPLEtBQUssS0FBSyxFQUFFOzRCQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQTt5QkFDL0I7NkJBQU07NEJB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QUFLLEdBQUcsSUFBSSxDQUFBO1lBRWhCLElBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7Z0JBRXRCLFlBQVksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO2dCQUVoQyxJQUFJLEdBQUcsR0FBUSxFQUFFLENBQUE7Z0JBRWpCLEdBQUcsQ0FBQyxLQUFLLEdBQUcsU0FBUyxHQUFHLEVBQUUsQ0FBQTtnQkFDMUIsR0FBRyxDQUFDLEtBQUssR0FBRyxTQUFTLEdBQUcsRUFBRSxDQUFBO2dCQUUxQixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQTtnQkFDekMsSUFBSSxVQUFVLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxvQkFBb0IsRUFBRSxvQkFBb0IsRUFBRSxxQkFBcUIsQ0FBQyxDQUFBO2dCQUN4RyxHQUFHLENBQUMsT0FBTyxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQTtnQkFDL0IsSUFBSSxTQUFTLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO2dCQUNoRCxLQUFLLENBQUMsT0FBTyxDQUFDO29CQUNaLFNBQVM7aUJBQ1YsQ0FBQyxDQUFBO2FBRUg7WUFDRCxJQUFJLE9BQU8sR0FBRyxVQUFVLENBQUM7Z0JBQ3ZCLEtBQUssQ0FBQyxPQUFPLENBQUM7b0JBQ1osU0FBUyxFQUFFLEVBQUU7aUJBQ2QsQ0FBQyxDQUFBO1lBQ0osQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFBO1lBQ1AsS0FBSyxDQUFDLE9BQU8sQ0FBQztnQkFDWixPQUFPO2FBQ1IsQ0FBQyxDQUFBO1FBRUosQ0FBQztLQUNGO0NBRUYsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiXG5sZXQgdG91Y2hEb3RYID0gMDsvL1jmjInkuIvml7blnZDmoIdcbmxldCB0b3VjaERvdFkgPSAwOy8veeaMieS4i+aXtuWdkOagh1xuQ29tcG9uZW50KHtcbiAgcHJvcGVydGllczoge1xuICAgIGR1cmF0aW9uOiB7XG4gICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICB2YWx1ZTogNTAwXG4gICAgfSxcbiAgICBlYXNpbmdGdW5jdGlvbjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgdmFsdWU6ICdkZWZhdWx0J1xuICAgIH0sXG4gICAgbG9vcDoge1xuICAgICAgdHlwZTogQm9vbGVhbixcbiAgICAgIHZhbHVlOiB0cnVlXG4gICAgfSxcbiAgICBwYXVzZUN1cnJlbnRWaWRlbzoge1xuICAgICAgdHlwZTogQm9vbGVhbixcbiAgICAgIHZhbHVlOiBmYWxzZSxcbiAgICAgIG9ic2VydmVyOiBmdW5jdGlvbiBvYnNlcnZlcigpIHtcbiAgICAgICAgbGV0IGN1cnJlbnQgPSB0aGlzLmRhdGEuX2xhc3RcbiAgICAgICAgbGV0IHsgY3VyUXVldWUgfSA9IHRoaXMuZGF0YVxuICAgICAgICBsZXQgdGhhdDogYW55ID0gdGhpc1xuICAgICAgICBpZiAoYXJndW1lbnRzWzBdKSB7XG4gICAgICAgICAgY3VyUXVldWUuZm9yRWFjaChmdW5jdGlvbiAoaXRlbTogYW55KSB7XG4gICAgICAgICAgICBpdGVtLmlzUGxheSA9IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5kYXRhLl92aWRlb0NvbnRleHRzLmZvckVhY2goZnVuY3Rpb24gKCBpbmRleDogYW55KSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudCA9PT0gaW5kZXgpIHtcbiAgICAgICAgICAgICAgdGhhdC5kYXRhLl92aWRlb0NvbnRleHQucGxheSgpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyDlronljZPnnJ/mnLp2aWRlb0NvbnRleHQucGF1c2UoKeaWueazleS4jei1t+S9nOeUqO+8n+WKoOWumuaXtuWZqFxuICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGF0LmRhdGEuX3ZpZGVvQ29udGV4dC5wYXVzZSgpXG4gICAgICAgICAgICAgIH0sIDEwMClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGN1cnJlbnQgPT09IGluZGV4ID8gY3R4LnBsYXkoKSA6IGN0eC5wYXVzZSgpXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY3VyUXVldWUuZm9yRWFjaChmdW5jdGlvbiAoaXRlbTogYW55LCBpbmRleDogYW55KSB7XG4gICAgICAgICAgICBpdGVtLmlzUGxheSA9IGN1cnJlbnQgPT09IGluZGV4ID8gdHJ1ZSA6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICBjdXJRdWV1ZVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0sXG4gICAgdmlkZW9MaXN0OiB7XG4gICAgICB0eXBlOiBBcnJheSxcbiAgICAgIHZhbHVlOiBbXSxcbiAgICAgIG9ic2VydmVyOiBmdW5jdGlvbiBvYnNlcnZlcigpIHtcbiAgICAgICAgdmFyIG5ld1ZhbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107XG4gICAgICAgIG5ld1ZhbCAmJiB0aGlzLl92aWRlb0xpc3RDaGFuZ2VkKG5ld1ZhbCk7XG4gICAgICB9XG4gICAgfSxcbiAgfSxcbiAgZGF0YToge1xuICAgIG5leHRRdWV1ZTogPGFueT5bXSwvKirmnKrooqvmlL7lhaVzd2lwZXLnmoTmlbDnu4QgKi9cbiAgICBwcmV2UXVldWU6IDxhbnk+W10sLyoq5bey57uP6KKr5pS+5YWl6L+Hc3dpcGVy55qE5pWw57uEICovXG4gICAgY3VyUXVldWU6IDxhbnk+W10sLyoq5pS+5YWlc3dpcGVy5Lit55qE5pWw57uEICovXG4gICAgY2lyY3VsYXI6IGZhbHNlLFxuICAgIF9sYXN0OiAwLCAvKirorrDlvZVjdXJyZW5055qE5ruR5Yqo5YmN55qE5YC8ICovXG4gICAgX2NoYW5nZTogLTIsXG4gICAgX2ludmFsaWRVcDogMCxcbiAgICBfaW52YWxpZERvd246IDAsXG4gICAgX3ZpZGVvQ29udGV4dHM6IDxhbnk+W10sXG4gICAgZGlmZjogMCwgLyoqIGRpZmbkuLow5pe25rKh5pyJ5ruR5YqoICovXG4gICAgc2hvd0NvbW1lbnRMaXN0OiBmYWxzZSxcbiAgICAvLyBjb21tZW50Q291bnQ6IDAsXG4gICAgaG90UmVwbHlMaXN0czogPGFueT5bXSxcbiAgICBuZXdSZXBseUxpc3RzOiA8YW55PltdLFxuICAgIHRvdWNoRGlyY3Rpb246IDAsLyoqMSDkuIrmu5EgMiDkuIvmu5EgKi9cbiAgICBsYXN0VGltZTogMCwgLyoqIOacgOWQjuS4gOasoeWNleWHu+S6i+S7tuWPkeeUn+eahOaXtumXtCAqL1xuICAgIGxhc3RUaW1lb3V0RnVuYzogPGFueT5bXSwvKiog5Y2V5Ye75LqL5Lu26Kem5Y+R55qE5Ye95pWwKi9cbiAgICAvLyBpc1BhdXNlOiBmYWxzZSwvKiog6KeG6aKR5pqC5YGc5LitICovXG4gICAgaGFzTG9naW46IGZhbHNlLC8qKiDmmK/lkKbnmbvlvZUgKi9cbiAgICBzaG93TG9naW5Qb3A6IGZhbHNlLC8qKiDmmL7npLrnmbvlvZXlvLnnqpcgKi9cbiAgICB0aW1lX2lkOiA2MDAsXG4gICAgbGlrZV9pbWdzOiBbXSxcbiAgfSxcbiAgbGlmZXRpbWVzOiB7XG4gICAgYXR0YWNoZWQoKSB7XG4gICAgfVxuICB9LFxuICBtZXRob2RzOiB7XG4gICAgdG91Y2hTdGFydDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHRvdWNoRG90WCA9IGUudG91Y2hlc1swXS5wYWdlWDsgLy8g6I635Y+W6Kem5pG45pe255qE5Y6f54K5XG4gICAgICB0b3VjaERvdFkgPSBlLnRvdWNoZXNbMF0ucGFnZVk7XG4gICAgfSxcbiAgICAvLyDop6bmkbjnu5PmnZ/kuovku7ZcbiAgICB0b3VjaEVuZDogZnVuY3Rpb24gKGUpIHtcbiAgICAgIGxldCB7IGN1clF1ZXVlIH0gPSB0aGlzLmRhdGFcbiAgICAgIGxldCB0b3VjaE1vdmVYID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWDtcbiAgICAgIGxldCB0b3VjaE1vdmVZID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWTtcbiAgICAgIGxldCB0bVggPSB0b3VjaE1vdmVYIC0gdG91Y2hEb3RYO1xuICAgICAgbGV0IHRtWSA9IHRvdWNoTW92ZVkgLSB0b3VjaERvdFk7XG4gICAgICBsZXQgYWJzWCA9IE1hdGguYWJzKHRtWCk7XG4gICAgICBsZXQgYWJzWSA9IE1hdGguYWJzKHRtWSk7XG4gICAgICBpZiAoYWJzWSA+IGFic1ggKiAyICYmIHRtWSA8IDEwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwi5LiK5ruR5YqoPT09PT1cIiwgdGhpcy5kYXRhLmRpZmYsIHRoaXMuZGF0YS5uZXh0UXVldWUpXG4gICAgICAgIFxuICAgICAgICBjdXJRdWV1ZS5mb3JFYWNoKChpdGVtOiBhbnksIGluZGV4OiBhbnkpID0+IHtcbiAgICAgICAgICBpZiAodGhpcy5kYXRhLl9sYXN0ID09PSBpbmRleCkge1xuICAgICAgICAgICAgaXRlbS5pc1NlZWsgPSB0cnVlXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGl0ZW0uaXNTZWVrID0gZmFsc2VcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgdG91Y2hEaXJjdGlvbjogMSxcbiAgICAgICAgICBjdXJRdWV1ZVxuICAgICAgICB9KVxuICAgICAgfSBlbHNlIGlmIChhYnNZID4gYWJzWCAqIDIgJiYgdG1ZID4gMTAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwi5LiL5ruR5YqoPT09PT1cIiwgdGhpcy5kYXRhLmRpZmYsIHRoaXMuZGF0YS5wcmV2UXVldWUpXG4gICAgICAgIGN1clF1ZXVlLmZvckVhY2goKGl0ZW06IGFueSwgaW5kZXg6IGFueSkgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLmRhdGEuX2xhc3QgPT09IGluZGV4KSB7XG4gICAgICAgICAgICBpdGVtLmlzU2VlayA9IHRydWVcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaXRlbS5pc1NlZWsgPSBmYWxzZVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICB0b3VjaERpcmN0aW9uOiAyLFxuICAgICAgICAgIGN1clF1ZXVlXG4gICAgICAgIH0pXG4gICAgICAgIGlmICghdGhpcy5kYXRhLnByZXZRdWV1ZS5sZW5ndGggJiYgdGhpcy5kYXRhLl9sYXN0ID09IDApIHtcbiAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgcHJldlF1ZXVlOiBbXSxcbiAgICAgICAgICAgIG5leHRRdWV1ZTogW11cbiAgICAgICAgICB9KVxuICAgICAgICAgIHRoaXMudHJpZ2dlckV2ZW50KCdmdW5jUHVsbGRvd25SZWZyZXNoJylcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfSxcblxuICAgIF92aWRlb0xpc3RDaGFuZ2VkOiBmdW5jdGlvbiBfdmlkZW9MaXN0Q2hhbmdlZChuZXdWYWwpIHtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTtcbiAgICAgIC8vIG5ld1ZhbC5mb3JFYWNoKGFzeW5jIGZ1bmN0aW9uIChpdGVtOiBhbnksIGluZGV4OiBhbnkpIHtcbiAgICAgIC8vICB9KTtcbiAgICAgIGRhdGEubmV4dFF1ZXVlID0gbmV3VmFsXG5cbiAgICAgIGlmIChkYXRhLmN1clF1ZXVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBkYXRhLmN1clF1ZXVlLmZvckVhY2goKGl0ZW06YW55KSA9PiB7XG4gICAgICAgICAgaXRlbS5pc1BsYXk9ZmFsc2VcbiAgICAgICAgICBpdGVtLmlzQ3VycmVudD1mYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICBjdXJRdWV1ZTogZGF0YS5uZXh0UXVldWUuc3BsaWNlKDAsIDMpXG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBfdGhpcy5wbGF5Q3VycmVudCgwKVxuICAgICAgICAgIF90aGlzLnRyaWdnZXJFdmVudCgnY2hhbmdlJywgeyBhY3RpdmVWaWRlbzogZGF0YS5jdXJRdWV1ZVswXSB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGFuaW1hdGlvbmZpbmlzaDogZnVuY3Rpb24gYW5pbWF0aW9uZmluaXNoKGUpIHtcbiAgICAgIGxldCB0aGF0OiBhbnkgPSB0aGlzXG4gICAgICBsZXQgeyBfbGFzdCwgX2NoYW5nZSwgY3VyUXVldWUsIHByZXZRdWV1ZSwgbmV4dFF1ZXVlLCB0b3VjaERpcmN0aW9uIH0gPSB0aGlzLmRhdGFcbiAgICAgIHZhciBjdXJyZW50ID0gZS5kZXRhaWwuY3VycmVudDtcbiAgICAgIHZhciBkaWZmID0gY3VycmVudCAtIF9sYXN0O1xuICAgICAgaWYgKGRpZmYgPT09IDApIHtcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICBkaWZmOiAwXG4gICAgICAgIH0pXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgICAgdGhpcy5kYXRhLl9sYXN0ID0gY3VycmVudDtcbiAgICAgIHRoaXMucGxheUN1cnJlbnQoY3VycmVudCk7XG4gICAgICB0aGlzLnRyaWdnZXJFdmVudCgnY2hhbmdlJywgeyBhY3RpdmVWaWRlbzogY3VyUXVldWVbY3VycmVudF0gfSk7XG4gICAgICB2YXIgZGlyZWN0aW9uID0gZGlmZiA9PT0gMSB8fCBkaWZmID09PSAtMiA/ICd1cCcgOiAnZG93bic7XG4gICAgICBpZiAobmV4dFF1ZXVlLmxlbmd0aCA9PT0gMiAmJiB0b3VjaERpcmN0aW9uID09IDEpIHtcbiAgICAgICAgLy/or7fmsYLmm7TlpJrmlbDmja5cbiAgICAgICAgdGhpcy50cmlnZ2VyRXZlbnQoJ2Z1bmNQYWdpbmF0aW9uJylcbiAgICAgIH1cbiAgICAgIGlmIChkaXJlY3Rpb24gPT09ICd1cCcpIHtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5faW52YWxpZERvd24gPT09IDApIHtcbiAgICAgICAgICB2YXIgY2hhbmdlID0gKF9jaGFuZ2UgKyAxKSAlIDM7XG4gICAgICAgICAgaWYgKGNoYW5nZSA8IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICAgIF9jaGFuZ2U6IGNoYW5nZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgYWRkID0gbmV4dFF1ZXVlLnNoaWZ0KCk7XG4gICAgICAgICAgdmFyIHJlbW92ZSA9IGN1clF1ZXVlW2NoYW5nZV07XG4gICAgICAgICAgaWYgKGFkZCkge1xuICAgICAgICAgICAgcHJldlF1ZXVlLnB1c2gocmVtb3ZlKTtcbiAgICAgICAgICAgIGN1clF1ZXVlW2NoYW5nZV0gPSBhZGQ7XG4gICAgICAgICAgICB0aGlzLmRhdGEuX2NoYW5nZSA9IGNoYW5nZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kYXRhLl9pbnZhbGlkVXAgKz0gMTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5kYXRhLl9pbnZhbGlkRG93biAtPSAxO1xuICAgICAgICB9XG5cblxuICAgICAgfVxuICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ2Rvd24nKSB7XG4gICAgICAgIGlmICh0aGlzLmRhdGEuX2ludmFsaWRVcCA9PT0gMCkge1xuXG4gICAgICAgICAgdmFyIF9jaGFuZ2UyID0gX2NoYW5nZTtcbiAgICAgICAgICB2YXIgX3JlbW92ZSA9IGN1clF1ZXVlW19jaGFuZ2UyXTtcbiAgICAgICAgICB2YXIgX2FkZCA9IHByZXZRdWV1ZS5wb3AoKTtcbiAgICAgICAgICBpZiAoX2FkZCkge1xuICAgICAgICAgICAgY3VyUXVldWVbX2NoYW5nZTJdID0gX2FkZDtcbiAgICAgICAgICAgIG5leHRRdWV1ZS51bnNoaWZ0KF9yZW1vdmUpO1xuXG4gICAgICAgICAgICB0aGlzLmRhdGEuX2NoYW5nZSA9IChfY2hhbmdlIC0gMSArIDMpICUgMztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kYXRhLl9pbnZhbGlkRG93biArPSAxO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmRhdGEuX2ludmFsaWRVcCAtPSAxO1xuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICAgIHZhciBjaXJjdWxhciA9IHRydWU7XG4gICAgICBpZiAobmV4dFF1ZXVlLmxlbmd0aCA9PT0gMCAmJiBjdXJyZW50ICE9PSAwKSB7XG4gICAgICAgIGNpcmN1bGFyID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAocHJldlF1ZXVlLmxlbmd0aCA9PT0gMCAmJiBjdXJyZW50ICE9PSAyKSB7XG4gICAgICAgIGNpcmN1bGFyID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhwcmV2UXVldWUsIGN1clF1ZXVlLCBuZXh0UXVldWUpXG5cbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGN1clF1ZXVlLFxuICAgICAgICBwcmV2UXVldWUsXG4gICAgICAgIG5leHRRdWV1ZSxcbiAgICAgICAgY2lyY3VsYXIsXG4gICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoYXQucGxheUN1cnJlbnQoY3VycmVudCk7XG4gICAgICAgIHRoYXQudHJpZ2dlckV2ZW50KCdjaGFuZ2UnLCB7IGFjdGl2ZVZpZGVvOiB0aGF0LmRhdGEuY3VyUXVldWVbY3VycmVudF0gfSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHBsYXlDdXJyZW50OiBmdW5jdGlvbiBwbGF5Q3VycmVudChjdXJyZW50KSB7XG4gICAgICBsZXQgeyBjdXJRdWV1ZSB9ID0gdGhpcy5kYXRhXG4gICAgICAvLyBjb25zb2xlLmxvZygn6L6T5Ye65q2j5Zyo5pKt5pS+55qE5YiX6KGoJyxjdXJRdWV1ZSlcbiAgICAgIGN1clF1ZXVlLmZvckVhY2goKGl0ZW06IGFueSwgaW5kZXg6IGFueSkgPT4ge1xuICAgICAgICBpdGVtLmlzUGxheSA9IGluZGV4ID09PSBjdXJyZW50ID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICBpdGVtLmlzQ3VycmVudCA9IGN1cnJlbnQgPT09IGluZGV4ID8gdHJ1ZSA6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGN1clF1ZXVlXG4gICAgICB9KVxuICAgIH0sXG4gXG5cbiAgICBnZXN0dXJlKGU6IGFueSkge1xuICAgICAgbGV0IGN1cnJlbnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKClcbiAgICAgIGxldCB7IGxhc3RUaW1lLCBsYXN0VGltZW91dEZ1bmMsIGN1clF1ZXVlIH0gPSB0aGlzLmRhdGFcbiAgICAgIGxldCBjdXJyZW50ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXhcbiAgICAgIGxldCBpc1BsYXkgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pc3BsYXlcbiAgICAgIGlmIChjdXJyZW50VGltZSAtIGxhc3RUaW1lIDwgMzAwKSB7XG4gICAgICAgIGNsZWFyVGltZW91dChsYXN0VGltZW91dEZ1bmMpXG4gICAgICAgIHRoaXMuZHJhd0xpa2VoZWFydCgpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsYXN0VGltZW91dEZ1bmMgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBjdXJRdWV1ZS5mb3JFYWNoKChpdGVtOiBhbnksIGluZGV4OiBhbnkpID0+IHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50ID09PSBpbmRleCkge1xuICAgICAgICAgICAgICBpdGVtLmlzUGxheSA9IGlzUGxheSA/IGZhbHNlIDogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICBjdXJRdWV1ZVxuICAgICAgICAgIH0pXG4gICAgICAgIH0sIDUwMClcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGxhc3RUaW1lOiBjdXJyZW50VGltZSxcbiAgICAgICAgbGFzdFRpbWVvdXRGdW5jXG4gICAgICB9KVxuICAgIH0sXG5cbiAgIFxuICAgIG9uUGxheShlKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoZSwgJ3BsYXknKVxuICAgIH0sXG5cbiAgICBvblBhdXNlKGUpIHtcbiAgICAgIHRoaXMudHJpZ2dlcihlLCAncGF1c2UnKVxuICAgIH0sXG5cbiAgICBvbkVuZGVkKGUpIHtcbiAgICAgIHRoaXMudHJpZ2dlcihlLCAnZW5kZWQnKVxuICAgIH0sXG5cbiAgICBvbkVycm9yKGUpIHtcbiAgICAgIHRoaXMudHJpZ2dlcihlLCAnZXJyb3InKVxuICAgIH0sXG5cbiAgICBvblRpbWVVcGRhdGUoZSkge1xuICAgICAgdGhpcy50cmlnZ2VyKGUsICd0aW1ldXBkYXRlJylcbiAgICB9LFxuXG4gICAgb25XYWl0aW5nKGUpIHtcbiAgICAgIHRoaXMudHJpZ2dlcihlLCAnd2FpdCcpXG4gICAgfSxcblxuICAgIG9uUHJvZ3Jlc3MoZSkge1xuICAgICAgdGhpcy50cmlnZ2VyKGUsICdwcm9ncmVzcycpXG4gICAgfSxcblxuICAgIG9uTG9hZGVkTWV0YURhdGEoZSkge1xuICAgICAgdGhpcy50cmlnZ2VyKGUsICdsb2FkZWRtZXRhZGF0YScpXG4gICAgfSxcbiAgICB0cmlnZ2VyKGUsIHR5cGUsIGV4dCA9IHt9KSB7XG4gICAgICBjb25zdCBkZXRhaWwgPSBlLmRldGFpbFxuICAgICAgY29uc3QgYWN0aXZlSWQgPSBlLnRhcmdldC5kYXRhc2V0LmlkXG4gICAgICB0aGlzLnRyaWdnZXJFdmVudCh0eXBlLCBPYmplY3QuYXNzaWduKHsuLi5kZXRhaWwsYWN0aXZlSWR9LCBleHQpKVxuICAgIH0sXG5cbiAgICAvKiog5Y+M5Ye754K56LWeIOeIseW/gyAqL1xuICAgIGRyYXdMaWtlaGVhcnQoKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzXG4gICAgICAvLyBjb25zb2xlLmxvZygn6L+b5YWl54K56LWe54ix5b+D5Yqo55S7JywgX3RoaXMuZGF0YS50aW1lX2lkKVxuICAgICAgaWYgKF90aGlzLmRhdGEudGltZV9pZCkgey8v5Yik5pat5piv5ZCm5pyJ5a6a5pe25ZmoXG4gICAgICAgIC8v5q+P5qyh6ZSA5q+B5a6a5pe25Zmo77yM5LiL5pa55Lya6YeN5paw6K6+5a6a5a6a5pe25ZmoXG4gICAgICAgIGNsZWFyVGltZW91dChfdGhpcy5kYXRhLnRpbWVfaWQpXG4gICAgICAgIC8v55Sf5oiQ5LiA5Liq5paw55qE5Yqo55S75YWD57SgXG4gICAgICAgIHZhciBvYmo6IGFueSA9IHt9XG4gICAgICAgIC8v6K6+5a6a57qi5b+D5Z2Q5qCHXG4gICAgICAgIG9iai5wYWdlWCA9IHRvdWNoRG90WCAtIDQwXG4gICAgICAgIG9iai5wYWdlWSA9IHRvdWNoRG90WSAtIDQwXG4gICAgICAgIC8v55Sf5oiQ6ZqP5py65Yqo55S757G777yM5q2k5aSE5oiR5pyJNOenjeWKqOeUu++8jOaJgOS7pemaj+acuuS7jjAtM+S5i+mXtOWPluWAvFxuICAgICAgICB2YXIgYW5nbGUgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KVxuICAgICAgICB2YXIgYW5pbWF0aW9ucyA9IFsnbGlrZS1pbWctYW5pbWF0ZScsICdsaWtlLWltZy1hbmltYXRlLWwnLCAnbGlrZS1pbWctYW5pbWF0ZS1yJywgJ2xpa2UtaW1nLWFuaW1hdGUtcnInXVxuICAgICAgICBvYmouYW5pbWF0ZSA9IGFuaW1hdGlvbnNbYW5nbGVdXG4gICAgICAgIHZhciBsaWtlX2ltZ3MgPSBfdGhpcy5kYXRhLmxpa2VfaW1ncy5jb25jYXQob2JqKS8v5bCG5paw55qE5Yqo55S75YWD57Sg5Yqg5YWl5YiwbGlrZV9pbWdz5pWw57uE5LitXG4gICAgICAgIF90aGlzLnNldERhdGEoey8v57uZbGlrZV9pbWdz5pWw57uE6LWL5YC8XG4gICAgICAgICAgbGlrZV9pbWdzXG4gICAgICAgIH0pXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdsaWtlX2ltZ3MnLCBsaWtlX2ltZ3MpXG4gICAgICB9XG4gICAgICB2YXIgdGltZV9pZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgey8v6K6+5a6a5a6a5pe25ZmoXG4gICAgICAgIF90aGlzLnNldERhdGEoe1xuICAgICAgICAgIGxpa2VfaW1nczogW10sLy/muIXnqbrliqjnlLvlhYPntKBcbiAgICAgICAgfSlcbiAgICAgIH0sIDYwMClcbiAgICAgIF90aGlzLnNldERhdGEoey8v5bCG5a6a5pe25Zmo5Yqg5YWl6aG16Z2i5Y+Y6YeP5LitXG4gICAgICAgIHRpbWVfaWRcbiAgICAgIH0pXG4gICAgICAvLyBjb25zb2xlLmxvZygndGltZV9pZCcsdGltZV9pZCx0aGlzLmRhdGEudGltZV9pZClcbiAgICB9LFxuICB9LFxuXG59KVxuXG5leHBvcnQgeyB9Il19